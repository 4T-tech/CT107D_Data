C51 COMPILER V9.56.0.0   DS1302                                                            01/25/2025 16:34:09 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE DS1302
OBJECT MODULE PLACED IN .\Objects\ds1302.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\Driver\ds1302.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Driver) DEFINE(PCF
                    -8591) DEBUG OBJECTEXTEND PRINT(.\Listings\ds1302.lst) TABS(2) OBJECT(.\Objects\ds1302.obj)

line level    source

   1          sfr  P1 = 0x90;
   2          sfr  P2 = 0xA0;
   3          sbit RST = P1^3;                      // DS1302复位
   4          sbit SCK = P1^7;                      // DS1302时钟
   5          sbit SDA = P2^3;                      // DS1302数据
   6          // DS1302写
   7          void DS1302_Write(unsigned  char ucData)
   8          {
   9   1        unsigned char i;
  10   1      
  11   1        for (i=0; i<8; i++)
  12   1        {
  13   2          SCK = 0;
  14   2          SDA = ucData & 1;
  15   2          ucData >>= 1;
  16   2          SCK = 1;
  17   2        }
  18   1      }
  19          // DS1302写字节，ucAddr的最低位为0
  20          void DS1302_WriteByte(unsigned char ucAddr, unsigned char ucData)
  21          {
  22   1        RST = 0;
  23   1        SCK = 0;
  24   1        RST = 1;
  25   1        DS1302_Write(ucAddr);
  26   1        DS1302_Write(ucData);
  27   1        RST = 0;
  28   1      }
  29          // DS1302读字节，ucAddr的最低位为1
  30          unsigned char DS1302_ReadByte(unsigned char ucAddr)
  31          {
  32   1        unsigned char i, temp=0;
  33   1      
  34   1        RST = 0;
  35   1        SCK = 0;
  36   1        RST = 1;
  37   1        DS1302_Write(ucAddr);
  38   1        for (i=0; i<8; i++)
  39   1        {
  40   2          SCK = 0;
  41   2          temp >>= 1;
  42   2          if (SDA)
  43   2            temp |= 0x80;
  44   2          SCK = 1;
  45   2        }
  46   1        RST = 0;
  47   1        SCK = 0;
  48   1        SDA = 0;
  49   1        return(temp);
  50   1      }
  51          // 设置RTC时钟：pucRtc-时钟值（时分秒：BCD码）
  52          void DS1302_SetRtc(unsigned char* pucRtc)
  53          {
  54   1        DS1302_WriteByte(0x8E, 0);          // WP=0：允许写操作
C51 COMPILER V9.56.0.0   DS1302                                                            01/25/2025 16:34:09 PAGE 2   

  55   1        DS1302_WriteByte(0x84, pucRtc[0]);  // 设置时
  56   1        DS1302_WriteByte(0x82, pucRtc[1]);  // 设置分
  57   1        DS1302_WriteByte(0x80, pucRtc[2]);  // 设置秒
  58   1        DS1302_WriteByte(0x8E, 0x80);       // WP=1：禁止写操作
  59   1      }
  60          // 获取RTC时钟：pucRtc-时钟值（时分秒：BCD码）
  61          void DS1302_GetRtc(unsigned char* pucRtc)
  62          {
  63   1        pucRtc[0] = DS1302_ReadByte(0x85);  // 读取时
  64   1        pucRtc[1] = DS1302_ReadByte(0x83);  // 读取分
  65   1        pucRtc[2] = DS1302_ReadByte(0x81);  // 读取秒
  66   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    150    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
